# アーキテクチャ設計書

## 概要

介護施設向け検食シフト作成システムは、モジュール化されたJavaScript構成により、保守性と拡張性を重視した設計となっています。

## モジュール構成

### 1. utils.js - ユーティリティ関数群
**責務**: 汎用的な処理を提供
- ストレージ可用性チェック
- クリップボード操作
- CSV データURL生成
- 日付・文字列処理

### 2. constants.js - 定数・初期設定
**責務**: アプリケーション全体で使用する定数を管理
- シフト種別、食事種別、役職の定義
- 初期スタッフ設定の生成
- デフォルト検食ルール

### 3. schedule.js - スケジュール管理
**責務**: スケジュールデータの構造管理
- 空のスケジュール構造生成
- スロット管理（勤務・検食）
- 利用可能スタッフの抽出
- 候補者フィルタリング

### 4. autoAssign.js - 自動割当機能
**責務**: 公平性を考慮した自動割当アルゴリズム
- 勤務シフト自動割当
- 検食ローテーション自動割当
- スタッフ統計管理
- 制約条件の考慮

### 5. csv.js - CSV出力機能
**責務**: 各種CSV形式での出力
- 検食ローテーション表
- 勤務シフト表
- スタッフ別勤務表
- データURL生成

### 6. storage.js - データ保存・読込
**責務**: ローカルストレージでのデータ永続化
- データ保存・読込
- バージョン管理
- 旧データからの移行処理

### 7. components.js - Reactコンポーネント
**責務**: UI コンポーネントの定義
- ヘッダーコンポーネント
- タブナビゲーション
- ダウンロードセンター

## データフロー

```
User Input → State Management → Business Logic → Data Persistence
     ↓              ↓                ↓              ↓
   React UI    → useState/useMemo → AutoAssign   → Storage
                                  → Schedule
                                  → CSV
```

## 設計原則

### 1. 単一責任の原則
各モジュールは明確に定義された単一の責務を持つ

### 2. 依存関係の最小化
モジュール間の依存関係を最小限に抑制

### 3. 拡張性の確保
新機能追加時の影響範囲を局所化

### 4. テスタビリティ
各モジュールが独立してテスト可能

## 利点

### 保守性の向上
- 機能ごとの分離により、バグ修正や機能追加が容易
- コードの可読性向上

### 再利用性
- 汎用的な関数は他のプロジェクトでも利用可能
- コンポーネントの再利用

### 開発効率
- 複数人での並行開発が可能
- 機能単位でのテスト・デバッグ

### パフォーマンス
- 必要な機能のみ読み込み
- ブラウザキャッシュの効率的利用

## 今後の拡張予定

### 1. 新機能追加
- 統計・レポート機能 → 新しいモジュールとして追加
- 印刷機能 → csv.js の拡張

### 2. UI改善
- components.js にコンポーネント追加
- スタイリングの分離

### 3. データ連携
- 外部システムとの連携 → 新しいAPIモジュール追加

この設計により、機能追加や修正時の影響範囲を最小限に抑え、長期的な保守性を確保しています。